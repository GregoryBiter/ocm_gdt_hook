<?xml version="1.0" encoding="utf-8"?>
<modification>
    <name>Global Registry Access</name>
    <code>global_registry_access</code>
    <version>1.0</version>
    <author>Your Name</author>
    <link>https://yourwebsite.com</link>
    <file path="system/engine/registry.php">

        <operation>
            <search><![CDATA[final class Registry {]]></search>
            <add position="before"><![CDATA[
if (is_file(DIR_SYSTEM . 'library/gbitstudio/gdt/engine/hook.php')) {
    require_once(DIR_SYSTEM . 'library/gbitstudio/gdt/engine/hook.php');
}
if (is_file(DIR_SYSTEM . 'library/gbitstudio/gdt/engine/hookcontroller.php')) {
    require_once(DIR_SYSTEM . 'library/gbitstudio/gdt/engine/hookcontroller.php');
}
if (is_file(DIR_SYSTEM . 'library/gbitstudio/gdt/engine/hookcache.php')) {
    require_once(DIR_SYSTEM . 'library/gbitstudio/gdt/engine/hookcache.php');
}
            ]]>            </add>
        </operation>

    </file>


    <!-- <file path="admin/controller/startup/router.php">
        <operation>
            <search><![CDATA[public function index() {]]></search>
<add position="after"><![CDATA[
        // роутинг
        $routeGDT = new \Gbitstudio\GDT\Engine\Route($this->registry);
        $routeGDT->router();
            ]]></add>
</operation>
</file> -->
    <!-- ########################################################################### -->

    <!-- Загружаем хуки GDT -->
    <file path="admin/controller/startup/startup.php">
        <operation>
            <search><![CDATA[public function index() {]]></search>
            <add position="after"><![CDATA[
        // Ініціалізація GDT Framework
        try {
            
            // Завантажуємо хуки
            if (class_exists('\GbitStudio\GDT\Engine\Hook')) {
                \GbitStudio\GDT\Engine\Hook::load($this->registry);
            }
        } catch (Exception $e) {
            // Логируем ошибку, но не прерываем выполнение
            error_log('GDT Framework init error: ' . $e->getMessage());
        }
            ]]>            </add>
        </operation>
    </file>
    
    <!-- Загружаем хуки GDT для catalog (frontend) -->
    <file path="catalog/controller/startup/startup.php">
        <operation>
            <search><![CDATA[public function index() {]]></search>
            <add position="after"><![CDATA[
        // Ініціалізація GDT Framework для catalog
        try {
            
            // Завантажуємо хуки
            if (class_exists('\GbitStudio\GDT\Engine\Hook')) {
                \GbitStudio\GDT\Engine\Hook::load($this->registry);
            }
        } catch (Exception $e) {
            // Логируем ошибку, но не прерываем выполнение
            error_log('GDT Framework init error (catalog): ' . $e->getMessage());
        }
            ]]>            </add>
        </operation>
    </file>
    <!-- ########################################################################### -->

    <file path="admin/controller/common/column_left.php">
        <operation>
            <search><![CDATA[// Stats]]></search>
            <add position="before"><![CDATA[
            //OCMOD GTB Hook
            $data['menus'] = \GbitStudio\GDT\Engine\Hook::apply_filters('common_column_left_menus', $data['menus'], $this);
            //OCMOD GTB Hook

            ]]>            </add>
        </operation>
    </file>

    <!-- <file path="system/engine/event.php">
        <operation>
            <search><![CDATA[foreach ($this->data as $value) {]]></search>
            <add position="before"><![CDATA[
        //OCMOD GDT Hook - Триггерим событие через систему хуков с передачей по ссылке
        \GbitStudio\GDT\Engine\Hook::trigger_oc_event($event, $args);
        //OCMOD GDT Hook

            ]]>            </add>
        </operation>

        <operation>
            <search><![CDATA[$result = $value['action']->execute($this->registry, $args);]]></search>
            <add position="after"><![CDATA[
        //OCMOD GDT Hook - Триггерим событие после выполнения с передачей по ссылке
        \GbitStudio\GDT\Engine\Hook::trigger_oc_event($event . '_after', $args, $result);
        //OCMOD GDT Hook

            ]]>            </add>
        </operation>

    </file> -->


    <!-- add_route -->
    <file path="admin/controller/startup/router.php">
        <operation>
            <search><![CDATA[public function index() {]]></search>
            <add position="after"><![CDATA[
        // Инициализация глобального реестра
        //Hook::load();
        
        // Добавляем маршруты из хуков
        //Hook::add_routes();
            ]]>            </add>
        </operation>
    </file>

    <!-- Обработка установки и удаления хуков -->
    <file path="admin/controller/extension/extension/module.php">
        <operation>
            <search><![CDATA[public function install() {]]></search>
            <add position="after"><![CDATA[
        //OCMOD GDT Hook - Очищаємо кеш при встановленні розширення
        if (class_exists('\GbitStudio\GDT\Engine\HookCache')) {
            \GbitStudio\GDT\Engine\HookCache::clear();
        }
        //OCMOD GDT Hook
            ]]>            </add>
        </operation>
        
        <operation>
            <search><![CDATA[public function uninstall() {]]></search>
            <add position="after"><![CDATA[
        //OCMOD GDT Hook - Очищаємо кеш при видаленні розширення
        if (class_exists('\GbitStudio\GDT\Engine\HookCache')) {
            \GbitStudio\GDT\Engine\HookCache::clear();
        }
        //OCMOD GDT Hook
            ]]>            </add>
        </operation>
    </file>
</modification>