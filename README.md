# GDT Hook Module

## –û–ø–∏—Å–∞–Ω–∏–µ

–ú–æ–¥—É–ª—å **GDT Hook** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ö—É–∫–æ–≤ (hooks) –¥–ª—è OpenCart, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é WordPress. –≠—Ç–æ—Ç –º–æ–¥—É–ª—å –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –≥–¥–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–≥—É—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É —Å–æ–±—ã—Ç–∏–π –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –Ω–µ –∏–∑–º–µ–Ω—è—è –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

- üîó **–°–∏—Å—Ç–µ–º–∞ —Ö—É–∫–æ–≤ WordPress-style** - –∑–Ω–∞–∫–æ–º—ã–π API –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚ö° **Action —Ö—É–∫–∏** - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–æ—á–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- üîß **Filter —Ö—É–∫–∏** - –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ —Ü–µ–ø–æ—á–∫—É —Ñ–∏–ª—å—Ç—Ä–æ–≤
- üìÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenCart Events** - —Ä–∞–±–æ—Ç–∞ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏ OpenCart
- üìÅ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ö—É–∫–æ–≤** - —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `admin/controller/hook/`
- üéõÔ∏è **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** - —É—Å—Ç–∞–Ω–æ–≤–∫–∞/—É–¥–∞–ª–µ–Ω–∏–µ —Ö—É–∫–æ–≤ –∫–∞–∫ –º–æ–¥—É–ª–µ–π
- üìù **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ö—É–∫–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –æ–ø–∏—Å–∞–Ω–∏–π –∏–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- üéØ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** - –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ö—É–∫–æ–≤

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PHP 7.4 –∏–ª–∏ –≤—ã—à–µ
- OpenCart 3.x/4.x
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤ –∏–º–µ–Ω (namespace)
- –°–∏—Å—Ç–µ–º–∞ OCMOD –≤–∫–ª—é—á–µ–Ω–∞

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ `upload/` –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤–∞—à–µ–≥–æ OpenCart
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ OCMOD —Ñ–∞–π–ª —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: Extensions ‚Üí Installer
   - –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª `gdt_hook.ocmod.xml`
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: Extensions ‚Üí Modifications
   - –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Refresh"

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
```
system/gdt_hook.ocmod.xml                           # OCMOD –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
system/library/gbitstudio/gdt/engine/hook.php       # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å Hook
system/library/gbitstudio/gdt/engine/hookcontroller.php      # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Ö—É–∫–æ–≤
system/library/gbitstudio/gdt/engine/hookmetaparser.php      # –ü–∞—Ä—Å–µ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
```

## –°–æ–∑–¥–∞–Ω–∏–µ —Ö—É–∫–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—É–∫–∞

–•—É–∫–∏ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `admin/controller/hook/` –∏ –¥–æ–ª–∂–Ω—ã —Å–ª–µ–¥–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ:

```php
<?php
/*
 * name: –ú–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ö—É–∫
 * description: –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ö—É–∫–∞
 * version: 1.0.0
 * author: –í–∞—à–µ –ò–º—è
 * controller: extension/module/my_hook
 * hidden: false
 */

namespace GbitStudio\GDT\Engine;

class MyHook extends HookController {
    
    public function boot() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö—É–∫–∞
        $this->registerHooks();
    }
    
    private function registerHooks() {
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è action —Ö—É–∫–æ–≤
        Hook::add_action('init', [$this, 'onInit'], 10, 1);
        Hook::add_action('admin_header', [$this, 'addCustomCSS'], 20);
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è filter —Ö—É–∫–æ–≤
        Hook::add_filter('product_data', [$this, 'modifyProductData'], 10, 2);
        Hook::add_filter('menu_items', [$this, 'addMenuItems'], 15, 1);
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è OpenCart —Å–æ–±—ã—Ç–∏–π
        Hook::add_event('catalog/model/checkout/order/addOrder/after', [$this, 'afterOrderAdd']);
    }
    
    public function onInit($data) {
        // –î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        error_log('Hook initialized with data: ' . print_r($data, true));
    }
    
    public function addCustomCSS() {
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ CSS –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
        echo '<link rel="stylesheet" href="/admin/view/stylesheet/my-hook.css">';
    }
    
    public function modifyProductData($product_data, $product_id) {
        // –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞
        $product_data['custom_field'] = 'Added by hook';
        return $product_data;
    }
    
    public function addMenuItems($menu_items) {
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É–Ω–∫—Ç–æ–≤ –≤ –º–µ–Ω—é
        $menu_items[] = [
            'name' => 'Custom Menu Item',
            'href' => 'extension/module/my_hook'
        ];
        return $menu_items;
    }
    
    public function afterOrderAdd($route, $args) {
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
        $order_id = $args[0];
        // –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞
    }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö—É–∫–∞
if (class_exists('GbitStudio\GDT\Engine\Hook')) {
    $hook = new MyHook(registry());
    $hook->boot();
}
```

## API —Å–∏—Å—Ç–µ–º—ã —Ö—É–∫–æ–≤

### Action —Ö—É–∫–∏

Action —Ö—É–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç –¥–µ–π—Å—Ç–≤–∏—è –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–æ—á–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

```php
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è action —Ö—É–∫–∞
Hook::add_action('hook_name', 'callback_function', $priority, $accepted_args);

// –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ action —Ö—É–∫–∞
Hook::do_action('hook_name', $arg1, $arg2, $arg3);
```

#### –ü—Ä–∏–º–µ—Ä—ã action —Ö—É–∫–æ–≤:

```php
// –ü—Ä–æ—Å—Ç–æ–π action —Ö—É–∫
Hook::add_action('admin_init', function() {
    // –ö–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
});

// Action —Ö—É–∫ —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
Hook::add_action('user_login', function($user_id, $user_data) {
    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    error_log("User $user_id logged in");
}, 10, 2);

// Action —Ö—É–∫ —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
Hook::add_action('before_save_product', function($product_data) {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–æ–≤–∞—Ä–∞
    if (empty($product_data['name'])) {
        throw new Exception('Product name is required');
    }
}, 5, 1);

// –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ action —Ö—É–∫–æ–≤
Hook::do_action('admin_init');
Hook::do_action('user_login', $user_id, $user_data);
Hook::do_action('before_save_product', $product_data);
```

### Filter —Ö—É–∫–∏

Filter —Ö—É–∫–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ–ø—É—Å–∫–∞—è –∏—Ö —á–µ—Ä–µ–∑ —Ü–µ–ø–æ—á–∫—É —Ñ–∏–ª—å—Ç—Ä–æ–≤:

```php
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è filter —Ö—É–∫–∞
Hook::add_filter('filter_name', 'callback_function', $priority, $accepted_args);

// –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ filter —Ö—É–∫–∞
$modified_value = Hook::apply_filters('filter_name', $original_value, $arg1, $arg2);
```

#### –ü—Ä–∏–º–µ—Ä—ã filter —Ö—É–∫–æ–≤:

```php
// –ü—Ä–æ—Å—Ç–æ–π filter —Ö—É–∫
Hook::add_filter('product_price', function($price) {
    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏ 10%
    return $price * 0.9;
});

// Filter —Ö—É–∫ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
Hook::add_filter('product_description', function($description, $product_id, $language_id) {
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫ –æ–ø–∏—Å–∞–Ω–∏—é
    return '[ID: ' . $product_id . '] ' . $description;
}, 10, 3);

// –¶–µ–ø–æ—á–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
Hook::add_filter('email_content', function($content) {
    return $content . "\n\nWith regards,\nYour Team";
}, 10);

Hook::add_filter('email_content', function($content) {
    return strtoupper($content); // –í–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
}, 20);

// –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
$price = Hook::apply_filters('product_price', 100); // –†–µ–∑—É–ª—å—Ç–∞—Ç: 90
$description = Hook::apply_filters('product_description', 'Product desc', 123, 1);
$email = Hook::apply_filters('email_content', 'Hello!'); // –¶–µ–ø–æ—á–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
```

### OpenCart Events

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏ OpenCart:

```php
// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–±—ã—Ç–∏—è
Hook::add_event('catalog/model/checkout/order/addOrder/after', function($route, $args) {
    $order_id = $args[0];
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
}, 0);

// –°–æ–±—ã—Ç–∏–µ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
Hook::add_event('controller/*/before', function($route, $args) {
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
});

// –°–æ–±—ã—Ç–∏–µ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
Hook::add_event('model/*/after', function($route, $args, $output) {
    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –º–æ–¥–µ–ª—è–º
});
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

```php
<?php
/*
 * name: Notification System
 * description: –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
 * version: 1.0.0
 * author: GbitStudio
 */

namespace GbitStudio\GDT\Engine;

class NotificationHook extends HookController {
    
    public function boot() {
        Hook::add_action('admin_header', [$this, 'showNotifications']);
        Hook::add_action('order_status_change', [$this, 'notifyOrderStatusChange'], 10, 2);
        Hook::add_filter('admin_menu', [$this, 'addNotificationMenu']);
    }
    
    public function showNotifications() {
        $notifications = $this->getUnreadNotifications();
        
        if (!empty($notifications)) {
            echo '<div class="alert alert-info">';
            echo '<strong>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (' . count($notifications) . '):</strong><br>';
            foreach ($notifications as $notification) {
                echo '‚Ä¢ ' . $notification['message'] . '<br>';
            }
            echo '</div>';
        }
    }
    
    public function notifyOrderStatusChange($order_id, $new_status) {
        $this->addNotification([
            'type' => 'order_status',
            'message' => "–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ #$order_id –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: $new_status",
            'created_at' => date('Y-m-d H:i:s')
        ]);
    }
    
    public function addNotificationMenu($menu_items) {
        $menu_items[] = [
            'name' => '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è',
            'href' => 'extension/module/notifications',
            'icon' => 'fa-bell'
        ];
        return $menu_items;
    }
    
    private function getUnreadNotifications() {
        // –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        return [];
    }
    
    private function addNotification($notification) {
        // –õ–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    }
}

if (class_exists('GbitStudio\GDT\Engine\Hook')) {
    $hook = new NotificationHook(registry());
    $hook->boot();
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∞—É–¥–∏—Ç–∞

```php
<?php
/*
 * name: Audit System
 * description: –°–∏—Å—Ç–µ–º–∞ –∞—É–¥–∏—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
 * version: 1.0.0
 * author: GbitStudio
 */

namespace GbitStudio\GDT\Engine;

class AuditHook extends HookController {
    
    public function boot() {
        // –ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π —Å —Ç–æ–≤–∞—Ä–∞–º–∏
        Hook::add_event('admin/model/catalog/product/addProduct/after', [$this, 'logProductAdd']);
        Hook::add_event('admin/model/catalog/product/editProduct/after', [$this, 'logProductEdit']);
        Hook::add_event('admin/model/catalog/product/deleteProduct/after', [$this, 'logProductDelete']);
        
        // –ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π —Å –∑–∞–∫–∞–∑–∞–º–∏
        Hook::add_event('admin/model/sale/order/addOrderHistory/after', [$this, 'logOrderHistory']);
        
        // –§–∏–ª—å—Ç—Ä –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞—É–¥–∏—Ç–µ
        Hook::add_filter('admin_dashboard_data', [$this, 'addAuditInfo']);
    }
    
    public function logProductAdd($route, $args, $output) {
        $product_id = $output;
        $this->logAction('product_add', [
            'product_id' => $product_id,
            'user_id' => $this->getUserId(),
            'ip_address' => $this->getClientIP()
        ]);
    }
    
    public function logProductEdit($route, $args) {
        $product_id = $args[0];
        $this->logAction('product_edit', [
            'product_id' => $product_id,
            'user_id' => $this->getUserId(),
            'changes' => $args[1], // –î–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
            'ip_address' => $this->getClientIP()
        ]);
    }
    
    public function logProductDelete($route, $args) {
        $product_id = $args[0];
        $this->logAction('product_delete', [
            'product_id' => $product_id,
            'user_id' => $this->getUserId(),
            'ip_address' => $this->getClientIP()
        ]);
    }
    
    public function logOrderHistory($route, $args) {
        $order_id = $args[0];
        $order_status_id = $args[1];
        
        $this->logAction('order_status_change', [
            'order_id' => $order_id,
            'new_status_id' => $order_status_id,
            'user_id' => $this->getUserId(),
            'ip_address' => $this->getClientIP()
        ]);
    }
    
    public function addAuditInfo($dashboard_data) {
        $recent_actions = $this->getRecentAuditActions(10);
        $dashboard_data['audit_actions'] = $recent_actions;
        return $dashboard_data;
    }
    
    private function logAction($action_type, $data) {
        $db = registry('db');
        
        $db->query("
            INSERT INTO " . DB_PREFIX . "audit_log 
            SET action_type = '" . $db->escape($action_type) . "',
                data = '" . $db->escape(json_encode($data)) . "',
                created_at = NOW()
        ");
    }
    
    private function getUserId() {
        $session = registry('session');
        return isset($session->data['user_id']) ? $session->data['user_id'] : 0;
    }
    
    private function getClientIP() {
        return $_SERVER['HTTP_X_FORWARDED_FOR'] ?? $_SERVER['REMOTE_ADDR'] ?? 'unknown';
    }
    
    private function getRecentAuditActions($limit) {
        $db = registry('db');
        
        $query = $db->query("
            SELECT * FROM " . DB_PREFIX . "audit_log 
            ORDER BY created_at DESC 
            LIMIT " . (int)$limit
        );
        
        return $query->rows;
    }
}

if (class_exists('GbitStudio\GDT\Engine\Hook')) {
    $hook = new AuditHook(registry());
    $hook->boot();
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

```php
<?php
/*
 * name: Cache System
 * description: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
 * version: 1.0.0
 * author: GbitStudio
 */

namespace GbitStudio\GDT\Engine;

class CacheHook extends HookController {
    
    public function boot() {
        // –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        Hook::add_filter('product_data', [$this, 'cacheProductData'], 5, 2);
        Hook::add_action('product_update', [$this, 'clearProductCache'], 10, 1);
        
        // –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        Hook::add_filter('category_tree', [$this, 'cacheCategoryTree'], 5, 1);
        Hook::add_action('category_update', [$this, 'clearCategoryCache']);
        
        // –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞
        Hook::add_action('admin_footer', [$this, 'scheduleCleanup']);
    }
    
    public function cacheProductData($product_data, $product_id) {
        $cache_key = 'product_' . $product_id;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à
        if ($cached_data = $this->getCache($cache_key)) {
            return $cached_data;
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–µ—à
        $this->setCache($cache_key, $product_data, 3600); // 1 —á–∞—Å
        
        return $product_data;
    }
    
    public function clearProductCache($product_id) {
        $this->deleteCache('product_' . $product_id);
        $this->deleteCache('product_related_' . $product_id);
    }
    
    public function cacheCategoryTree($categories) {
        $cache_key = 'category_tree';
        
        if ($cached_categories = $this->getCache($cache_key)) {
            return $cached_categories;
        }
        
        $this->setCache($cache_key, $categories, 7200); // 2 —á–∞—Å–∞
        
        return $categories;
    }
    
    public function clearCategoryCache() {
        $this->deleteCache('category_tree');
        $this->deleteCache('category_*'); // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –∫–µ—à–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    }
    
    public function scheduleCleanup() {
        // –ü–ª–∞–Ω–∏—Ä—É–µ–º –æ—á–∏—Å—Ç–∫—É —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–µ—à–∞
        if (rand(1, 100) === 1) { // 1% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
            $this->cleanupExpiredCache();
        }
    }
    
    private function getCache($key) {
        $cache_file = DIR_CACHE . 'gdt_' . md5($key) . '.cache';
        
        if (is_file($cache_file)) {
            $data = unserialize(file_get_contents($cache_file));
            
            if ($data['expires'] > time()) {
                return $data['content'];
            } else {
                unlink($cache_file); // –£–¥–∞–ª—è–µ–º —É—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–µ—à
            }
        }
        
        return false;
    }
    
    private function setCache($key, $content, $ttl = 3600) {
        $cache_file = DIR_CACHE . 'gdt_' . md5($key) . '.cache';
        
        $data = [
            'expires' => time() + $ttl,
            'content' => $content
        ];
        
        file_put_contents($cache_file, serialize($data));
    }
    
    private function deleteCache($pattern) {
        $files = glob(DIR_CACHE . 'gdt_*.cache');
        
        foreach ($files as $file) {
            if (strpos($pattern, '*') !== false) {
                // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ wildcards
                $regex = str_replace('*', '.*', preg_quote($pattern));
                if (preg_match('/' . $regex . '/', basename($file))) {
                    unlink($file);
                }
            } else {
                $cache_file = DIR_CACHE . 'gdt_' . md5($pattern) . '.cache';
                if ($file === $cache_file) {
                    unlink($file);
                }
            }
        }
    }
    
    private function cleanupExpiredCache() {
        $files = glob(DIR_CACHE . 'gdt_*.cache');
        
        foreach ($files as $file) {
            if (is_file($file)) {
                $data = unserialize(file_get_contents($file));
                if ($data['expires'] <= time()) {
                    unlink($file);
                }
            }
        }
    }
}

if (class_exists('GbitStudio\GDT\Engine\Hook')) {
    $hook = new CacheHook(registry());
    $hook->boot();
}
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö—É–∫–∞–º–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

–ú–æ–¥—É–ª—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Å–∏—Å—Ç–µ–º–æ–π –º–æ–¥—É–ª–µ–π OpenCart, –ø–æ–∑–≤–æ–ª—è—è —É–ø—Ä–∞–≤–ª—è—Ç—å —Ö—É–∫–∞–º–∏ —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

### –°–ø–∏—Å–æ–∫ —Ö—É–∫–æ–≤
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ: Extensions ‚Üí Extensions ‚Üí Modules
- –•—É–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º "(Hook)"
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö: –Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–≤—Ç–æ—Ä, –≤–µ—Ä—Å–∏—è

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ö—É–∫–∞
1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Ö—É–∫–∞ –≤ `admin/controller/hook/`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Extensions ‚Üí Extensions ‚Üí Modules
3. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à —Ö—É–∫ –≤ —Å–ø–∏—Å–∫–µ
4. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Install"

### –£–¥–∞–ª–µ–Ω–∏–µ —Ö—É–∫–∞
1. –í —Å–ø–∏—Å–∫–µ –º–æ–¥—É–ª–µ–π –Ω–∞–π–¥–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ö—É–∫
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Uninstall"
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—É–∫–∞ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
ocm_gdt_hook/
‚îú‚îÄ‚îÄ README.md                                           # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îî‚îÄ‚îÄ upload/
    ‚îî‚îÄ‚îÄ system/
        ‚îú‚îÄ‚îÄ gdt_hook.ocmod.xml                          # OCMOD –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
        ‚îî‚îÄ‚îÄ library/
            ‚îî‚îÄ‚îÄ gbitstudio/
                ‚îî‚îÄ‚îÄ gdt/
                    ‚îî‚îÄ‚îÄ engine/
                        ‚îú‚îÄ‚îÄ hook.php                    # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å Hook
                        ‚îú‚îÄ‚îÄ hookcontroller.php          # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Ö—É–∫–æ–≤
                        ‚îî‚îÄ‚îÄ hookmetaparser.php          # –ü–∞—Ä—Å–µ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
```

## –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ OCMOD

–ú–æ–¥—É–ª—å –≤–Ω–æ—Å–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —è–¥—Ä–æ OpenCart:

### 1. Registry –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∞—Å—Å–æ–≤ Hook, HookController, HookMetaParser

### 2. –ú–æ–¥—É–ª—å Extensions/Modules
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ö—É–∫–æ–≤ –≤ `admin/controller/hook/`
- –ü–∞—Ä—Å–∏–Ω–≥ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ö—É–∫–æ–≤
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ö—É–∫–æ–≤ –≤ —Å–ø–∏—Å–∫–µ –º–æ–¥—É–ª–µ–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏/—É–¥–∞–ª–µ–Ω–∏—è —Ö—É–∫–æ–≤

### 3. Startup –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Ö—É–∫–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

### 4. Event —Å–∏—Å—Ç–µ–º–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenCart —Å–æ–±—ã—Ç–∏—è–º–∏
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–æ –∏ –ø–æ—Å–ª–µ —Å–æ–±—ã—Ç–∏–π

### 5. Column Left (–º–µ–Ω—é)
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫ –º–µ–Ω—é –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã** –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
2. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö —Ö—É–∫–æ–≤
3. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏** –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö —Ö—É–∫–æ–≤
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º–µ–Ω** –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
5. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å –¥—Ä—É–≥–∏–º–∏ —Ö—É–∫–∞–º–∏
6. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## –û—Ç–ª–∞–¥–∫–∞ —Ö—É–∫–æ–≤

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ö—É–∫–æ–≤

```php
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
Hook::add_action('debug_log', function($message) {
    error_log('[GDT Hook Debug] ' . $message);
});

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ö—É–∫–∞—Ö
Hook::do_action('debug_log', 'Product data modified: ' . $product_id);
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ö—É–∫–æ–≤

```php
// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö action —Ö—É–∫–æ–≤
$actions = Hook::getRegisteredActions();

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö filter —Ö—É–∫–æ–≤
$filters = Hook::getRegisteredFilters();
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ —Ö—É–∫–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ë–î
- –õ–æ–≥–∏—Ä—É–π—Ç–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ö—É–∫–æ–≤

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ò–∑–±–µ–≥–∞–π—Ç–µ —Ç—è–∂–µ–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Ö—É–∫–∞—Ö —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ–º—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö—É–∫–æ–≤ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç—è—Ö

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é GDT Framework –¥–ª—è OpenCart. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞.

## –õ–∏—Ü–µ–Ω–∑–∏—è

–ú–æ–¥—É–ª—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ª–∏—Ü–µ–Ω–∑–∏–µ–π –æ—Å–Ω–æ–≤–Ω–æ–≥–æ GDT Framework.
